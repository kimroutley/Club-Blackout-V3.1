# Role Per-Role Report

Generated by `tools/generate_role_report.ps1`.

## What this shows
- Role config (from `assets/data/roles.json`)
- Where the role is referenced in engine/script/player state
- Where the role is referenced in tests
- Flags when a role has no obvious wiring (script + engine references)

## The Ally Cat (`ally_cat`)

**Config**
- alliance: `The Party Animals`
- type: `investigative`
- night_priority: `0`
- ability: `(none)`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L883: if (victim.role.id == 'ally_cat') {
- lib/logic/script_builder.dart
  - L214: const integratedRoleIds = {'whore', 'ally_cat', 'wallflower'};
  - L556: (p) => p.isActive && p.role.id == 'ally_cat',
  - L581: roleId: 'ally_cat',
- lib/models/player.dart
  - L102: if (role.id == 'ally_cat') {

**Test Mentions (sample)**
- test/gameplay_scenarios_test.dart
  - L553: gameEngine.addPlayer('AC1', role: roleRepository.getRoleById('ally_cat'));
  - L565: (p) => p.role.id == 'ally_cat',

## The Bartender (`bartender`)

**Config**
- alliance: `The Party Animals`
- type: `investigative`
- night_priority: `4`
- ability: `(none)`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `False`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L1834: case 'bartender':
  - L1843: "Bartender checked ${a.name} + ${b.name} → ${sameTeam ? 'SAME team' : 'DIFFERENT teams'}.",
  - L1846: logAction(step.title, 'Bartender needs two selections.');
- lib/logic/script_builder.dart
  - L761: } else if (role.id == 'bartender') {
  - L767: 'Bartender$creepText, open your eyes.\n\nSelect TWO players. You will learn if they are on the SAME team or DIFFERENT teams.\n\nBartender$creepText, close yo...
  - L771: roleId: 'bartender',

**Test Mentions (sample)**
- test/role_smoke_playthrough_all_roles_test.dart
  - L191: 'bartender': 'party_animal',

## The Bouncer (`bouncer`)

**Config**
- alliance: `The Party Animals`
- type: `investigative`
- night_priority: `2`
- ability: `(none)`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L578: if (newRole.id == 'bouncer') {
  - L580: (p) => p.id != playerId && p.role.id == 'bouncer' && p.isEnabled,
  - L598: 'Only one Bouncer is allowed. ${existing.name} already has this role.');
- lib/logic/script_builder.dart
  - L13: /// - Bouncer gets rules reminder (can check Minor but vulnerability risk)
  - L18: /// - Role-based actions in priority order: Dealer → Medic → Bouncer → Others
  - L212: // Whore wakes with Dealers. Wallflower wakes with Dealers. Ally Cat wakes with Bouncer.
- lib/models/player.dart
  - L39: // Roofi/Bouncer mechanics
  - L44: false; // Roofi lost ability due to Bouncer challenge
  - L46: false; // Bouncer lost ID ability due to failed challenge
- â€¦(20 more matches omitted)

**Test Mentions (sample)**
- test/gameplay_scenarios_test.dart
  - L39: gameEngine.addPlayer('Dana', role: roleRepository.getRoleById('bouncer'));
  - L58: role: roleRepository.getRoleById('bouncer'),
  - L86: test('Game requires at least 1 Medic and/or Bouncer', () {
- test/role_eventualities_matrix_test.dart
  - L63: final includeBouncer = roleUnderTest.id != 'bouncer';
  - L75: // Need at least one Medic and/or Bouncer, but both are unique.
  - L82: // Default to Medic; if missing, fall back to Bouncer.
- test/role_smoke_playthrough_all_roles_test.dart
  - L150: // Need at least one Medic and/or Bouncer. Prefer Medic unless this is under test.
  - L153: } else if (roleUnderTest.id == 'bouncer') {
  - L154: engine.addPlayer('Bouncer 1', role: roleUnderTest);
- test/roles_schema_test.dart
  - L193: test('required roles exist (dealer, party_animal, medic, bouncer)', () {
- â€¦(18 more matches omitted)

## The Clinger (`clinger`)

**Config**
- alliance: `Their Partner (Unconditional)`
- type: `passive-aggressive`
- night_priority: `0`
- ability: `(none)`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L68: // Callback for clinger double death (clinger, obsession)
  - L222: // Clinger mechanic: Clinger must vote exactly as their obsession votes.
  - L232: p.role.id == 'clinger' &&
- lib/logic/script_builder.dart
  - L11: /// - Clinger chooses obsession + sees their role card
  - L71: // Priority Order: 1. Clinger, 2. Creep, 3. Medic
  - L74: // 1. Clinger - Choose obsession (FIRST)
- lib/models/player.dart
  - L25: String? clingerPartnerId; // The Clinger's linked partner
  - L27: false; // Clinger freed by being called "controller"
- â€¦(57 more matches omitted)

**Test Mentions (sample)**
- test/full_game_scenarios_v2_test.dart
  - L89: test('Scenario 3: Clinger dies with Partner', () async {
  - L91: final clingerId = idOfRole('clinger');
  - L92: executeScriptStep('clinger', [partnerId]);
- test/gameplay_scenarios_test.dart
  - L361: group('Clinger Mechanics', () {
  - L362: test('Clinger votes always mirror obsession partner', () {
  - L363: gameEngine.addPlayer('Clinger1', role: roleRepository.getRoleById('clinger'));
- test/role_eventualities_matrix_test.dart
  - L346: test('Clinger heartbreak + Creep inheritance does not break flow', () async {
  - L352: final clinger = _firstAliveByRoleId(engine, 'clinger');
  - L361: 'clinger': 'party_animal',
- test/role_smoke_playthrough_all_roles_test.dart
  - L188: 'clinger': 'party_animal',
- â€¦(50 more matches omitted)

## The Club Manager (`club_manager`)

**Config**
- alliance: `None (Neutral)`
- type: `investigative`
- night_priority: `3`
- ability: `view_role`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L381: final clubManagerAlive = alive.any((p) => p.role.id == 'club_manager');
  - L384: winner: 'CLUB_MANAGER',
  - L1904: case 'club_manager':
- lib/logic/script_builder.dart
  - L606: if (role.id == 'club_manager') {
  - L616: roleId: 'club_manager',

**Test Mentions (sample)**
- test/gameplay_scenarios_test.dart
  - L345: role: roleRepository.getRoleById('club_manager'),
  - L357: expect(result!.winner, 'CLUB_MANAGER');
  - L918: role: roleRepository.getRoleById('club_manager'),
- test/night_resolver_victory_test.dart
  - L139: id: 'club_manager',
- test/role_eventualities_matrix_test.dart
  - L665: 'club_manager',
  - L681: final a = engine.players.firstWhere((p) => p.role.id == 'club_manager');

## The Creep (`creep`)

**Config**
- alliance: `Variable`
- type: `mimic`
- night_priority: `0`
- ability: `(none)`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L1041: // Creep
  - L1045: final creep = players.firstWhere((p) => p.role.id == 'creep');
  - L1046: creep.creepTargetId = creepTargetSelection;
- lib/logic/script_builder.dart
  - L10: /// - Creep chooses mimic target + sees their role card
  - L71: // Priority Order: 1. Clinger, 2. Creep, 3. Medic
  - L103: // 2. Creep - Choose who to mimic (SECOND)
- lib/models/player.dart
  - L19: String? creepTargetId; // For The Creep to store who they are mimicking
  - L113: // (e.g., Creep mimic / Second Wind conversion) changes it.
- â€¦(20 more matches omitted)

**Test Mentions (sample)**
- test/gameplay_scenarios_test.dart
  - L228: test('Creep mimicking Dealer does not immediately become a Dealer', () {
  - L235: role: roleRepository.getRoleById('creep'),
  - L239: final creep = gameEngine.players.firstWhere((p) => p.name == 'Creep1');
- test/role_eventualities_matrix_test.dart
  - L319: 'creep',
  - L326: // Creep has no start_alliance; it sets its alliance once it selects a
  - L333: 'creep': 'party_animal',
- test/role_smoke_playthrough_all_roles_test.dart
  - L189: 'creep': 'party_animal',
- â€¦(14 more matches omitted)

## The Dealer (`dealer`)

**Config**
- alliance: `The Dealers`
- type: `aggressive`
- night_priority: `5`
- ability: `(none)`
- repeatable: `True`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L49: final String winner; // e.g. 'DEALER', 'PARTY_ANIMAL'
  - L315: final dealer = roleRepository.getRoleById('dealer');
  - L318: if (dealer != null) addPlayer('Dealer1', role: dealer);
- lib/logic/script_builder.dart
  - L18: /// - Role-based actions in priority order: Dealer → Medic → Bouncer → Others
  - L20: /// - Integrated roles (Whore, Wallflower, Ally Cat) wake with Dealer
  - L181: // Whore is integrated into Dealer steps; no standalone wake needed.
- lib/models/player.dart
  - L35: bool secondWindPendingConversion = false; // Waiting for Dealer decision
  - L42: blockedKillNight; // If set to N, this Dealer cannot kill on Night N (single-dealer case)
  - L135: lives = dealerCount; // One life per Dealer
- â€¦(53 more matches omitted)

**Test Mentions (sample)**
- test/full_game_scenarios_v2_test.dart
  - L74: test('Scenario 1: Dealer kills Party Animal', () async {
  - L81: executeScriptStep('dealer', [victimId]);
  - L95: executeScriptStep('dealer', [partnerId]);
- test/game_engine_save_load_test.dart
  - L17: final dealerRole = roleRepo.getRoleById('dealer');
  - L59: fromRoleA: 'dealer',
  - L61: toRoleA: 'dealer',
- test/gameplay_scenarios_test.dart
  - L28: test('Game requires at least 1 Dealer', () {
  - L43: expect(validation.error, contains('Dealer'));
  - L49: role: roleRepository.getRoleById('dealer'),
- test/night_resolver_test.dart
  - L8: test('Dealer kills target when no protection exists', () {
- â€¦(213 more matches omitted)

## The Drama Queen (`drama_queen`)

**Config**
- alliance: `The Party Animals`
- type: `reactive`
- night_priority: `0`
- ability: `(none)`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L1821: case 'drama_queen':
- lib/logic/script_builder.dart
  - L748: } else if (role.id == 'drama_queen') {
  - L758: roleId: 'drama_queen',
  - L777: final actionType = role.id == 'drama_queen'

**Test Mentions (sample)**
- test/game_engine_save_load_test.dart
  - L18: final dramaQueenRole = roleRepo.getRoleById('drama_queen');
  - L60: fromRoleB: 'drama_queen',
  - L62: toRoleB: 'drama_queen',
- test/role_eventualities_matrix_test.dart
  - L664: 'drama_queen',
  - L677: final dq = engine.players.firstWhere((p) => p.role.id == 'drama_queen');

## The Lightweight (`lightweight`)

**Config**
- alliance: `The Party Animals`
- type: `passive`
- night_priority: `0`
- ability: `(none)`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `False`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L1772: case 'lightweight':
  - L1779: logAction(step.title, 'Lightweight taboo added: ${target.name}.');
- lib/logic/script_builder.dart
  - L187: // Lightweight (Priority 0) DOES need to run every night for the Taboo logic.
  - L189: if (p.role.nightPriority > 0 || p.role.id == 'lightweight') {
  - L735: } else if (role.id == 'lightweight') {
- lib/models/player.dart
  - L29: List<String> tabooNames = []; // Lightweight's forbidden names

**Test Mentions (sample)**
- test/gameplay_scenarios_test.dart
  - L696: role: roleRepository.getRoleById('lightweight'),

## The Medic (`medic`)

**Config**
- alliance: `The Party Animals`
- type: `defensive`
- night_priority: `1`
- ability: `(none)`
- has_binary_choice_at_start: `True`
- choices: `REVIVE, PROTECT`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L940: players.where((p) => p.role.id == 'medic').firstOrNull?.id ??
  - L941: 'medic',
  - L1079: '• The Dealers chose to kill ${target.name}. But! The Medic arrived just in time to save them!');
- lib/logic/script_builder.dart
  - L12: /// - Medic chooses strategy (PROTECT daily OR REVIVE once)
  - L18: /// - Role-based actions in priority order: Dealer → Medic → Bouncer → Others
  - L71: // Priority Order: 1. Clinger, 2. Creep, 3. Medic
- lib/models/player.dart
  - L18: false; // True if medic has used their one-time revive ability
  - L38: int? deathDay; // Day count when player died (for medic revive time limit)
- â€¦(35 more matches omitted)

**Test Mentions (sample)**
- test/full_game_scenarios_v2_test.dart
  - L75: final medic = gameEngine.players.firstWhere((p) => p.role.id == 'medic');
  - L77: medic.medicChoice = 'PROTECT_DAILY';
  - L82: executeScriptStep('medic', [medic.id]);
- test/gameplay_scenarios_test.dart
  - L34: gameEngine.addPlayer('Bob', role: roleRepository.getRoleById('medic'));
  - L51: gameEngine.addPlayer('Medic1', role: roleRepository.getRoleById('medic'));
  - L79: gameEngine.addPlayer('Medic1', role: roleRepository.getRoleById('medic'));
- test/night_resolver_test.dart
  - L70: test('Medic protects target from Dealer kill', () {
  - L84: id: 'medic',
  - L85: name: 'The Medic',
- test/role_eventualities_matrix_test.dart
  - L62: final includeMedic = roleUnderTest.id != 'medic';
- â€¦(75 more matches omitted)

## The Messy Bitch (`messy_bitch`)

**Config**
- alliance: `None (Neutral Survivor)`
- type: `chaos`
- night_priority: `1`
- ability: `(none)`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L347: winner: 'MESSY_BITCH',
  - L403: .where((p) => p.isEnabled && p.role.id == 'messy_bitch')
  - L1782: case 'messy_bitch':
- lib/logic/script_builder.dart
  - L56: (p) => p.role.id == 'messy_bitch' && p.isEnabled,
  - L277: if (role.id == 'messy_bitch' && messyBitchWithKill != null) {
  - L658: } else if (role.id == 'messy_bitch') {

**Test Mentions (sample)**
- test/full_game_scenarios_v2_test.dart
  - L117: executeScriptStep('messy_bitch', [p1Id]);
  - L120: executeScriptStep('messy_bitch', [p2Id]);
- test/gameplay_scenarios_test.dart
  - L984: role: roleRepository.getRoleById('messy_bitch'),
  - L989: gameEngine.players.firstWhere((p) => p.role.id == 'messy_bitch');
  - L997: expect(result!.winner, 'MESSY_BITCH');

## The Minor (`minor`)

**Config**
- alliance: `The Party Animals`
- type: `defensive`
- night_priority: `0`
- ability: `(none)`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L827: // Minor: cannot die to Dealer kill attempts until ID'd by the Bouncer.
  - L828: if (victim.role.id == 'minor' && isDealerKillAttempt && !victim.minorHasBeenIDd) {
  - L829: logAction('Minor',
- lib/logic/script_builder.dart
  - L13: /// - Bouncer gets rules reminder (can check Minor but vulnerability risk)
  - L567: 'Nod if Dealer. Shake head if not. If you I.D. The Minor, she becomes vulnerable to being killed later.',
- lib/models/player.dart
  - L30: bool minorHasBeenIDd = false; // Minor death protection flag

**Test Mentions (sample)**
- test/full_game_scenarios_v2_test.dart
  - L115: final p2Id = idOfRole('minor');
- test/gameplay_scenarios_test.dart
  - L488: test('Minor cannot die before being ID checked', () {
  - L493: gameEngine.addPlayer('Minor1', role: roleRepository.getRoleById('minor'));
  - L504: final minor = gameEngine.players.firstWhere((p) => p.role.id == 'minor');
- test/night_resolver_test.dart
  - L249: test('Minor immunity blocks Dealer kill until ID checked', () {
  - L263: id: 'minor',
  - L264: name: 'The Minor',
- test/role_eventualities_matrix_test.dart
  - L430: test('Minor cannot die to Dealer kill until ID’d', () async {
  - L436: 'minor',
  - L445: // Ensure Dealers target the Minor.
- â€¦(25 more matches omitted)

## The Party Animal (`party_animal`)

**Config**
- alliance: `The Party Animals`
- type: `passive`
- night_priority: `0`
- ability: `(none)`
- repeatable: `True`

**Wiring**
- script_builder.dart mention: `False`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L49: final String winner; // e.g. 'DEALER', 'PARTY_ANIMAL'
  - L317: final party = roleRepository.getRoleById('party_animal');
  - L374: winner: 'PARTY_ANIMAL',

**Test Mentions (sample)**
- test/full_game_scenarios_v2_test.dart
  - L76: final victimId = idOfRole('party_animal');
  - L90: final partnerId = idOfRole('party_animal');
  - L104: final victimId = idOfRole('party_animal');
- test/gameplay_scenarios_test.dart
  - L32: role: roleRepository.getRoleById('party_animal'),
  - L73: role: roleRepository.getRoleById('party_animal'),
  - L77: role: roleRepository.getRoleById('party_animal'),
- test/night_resolver_test.dart
  - L22: id: 'party_animal',
  - L95: id: 'party_animal',
  - L185: id: 'party_animal',
- test/night_resolver_victory_test.dart
  - L22: id: 'party_animal',
- â€¦(112 more matches omitted)

## The Predator (`predator`)

**Config**
- alliance: `The Party Animals`
- type: `reactive`
- night_priority: `0`
- ability: `(none)`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L100: // Predator retaliation in-flight state (persisted)
  - L1208: // Predator: capture eligible voters at the moment of elimination.
  - L1209: if (votedOutPlayer.role.id == 'predator') {
- lib/logic/script_builder.dart
  - L186: // Reactive roles (Tea Spiller, Predator, Drama Queen) share Priority 0 and shouldn't run automatically.
  - L722: } else if (role.id == 'predator') {
  - L728: 'Predator$creepText, open your eyes.\n\nMark a player. If you are voted out, this player will die with you.\n\nPredator$creepText, close your eyes.',
- â€¦(4 more matches omitted)

**Test Mentions (sample)**
- test/game_engine_save_load_test.dart
  - L19: final predatorRole = roleRepo.getRoleById('predator');
  - L43: // Pending Predator retaliation state (voter eligible list)
- test/role_eventualities_matrix_test.dart
  - L618: test('Predator retaliation captures voters and can kill an eligible voter',
  - L625: 'predator',
  - L637: final predator = engine.players.firstWhere((p) => p.role.id == 'predator');
- â€¦(1 more matches omitted)

## The Roofi (`roofi`)

**Config**
- alliance: `The Party Animals`
- type: `offensive`
- night_priority: `3`
- ability: `(none)`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L1711: case 'roofi':
  - L1713: nightActions['roofi'] = target.id;
  - L1717: 'Roofi silenced ${target.name} for Day ${dayCount + 1}.');
- lib/logic/script_builder.dart
  - L264: // Skip Roofi if their ability has been revoked
  - L265: if (role.id == 'roofi') {
  - L267: players.where((p) => p.isActive && p.role.id == 'roofi').toList();
- lib/models/player.dart
  - L39: // Roofi/Bouncer mechanics
  - L44: false; // Roofi lost ability due to Bouncer challenge
  - L48: false; // Bouncer gained Roofi ability from successful challenge
- â€¦(1 more matches omitted)

**Test Mentions (sample)**
- test/gameplay_scenarios_test.dart
  - L651: gameEngine.addPlayer('Roofi1', role: roleRepository.getRoleById('roofi'));
  - L688: gameEngine.addPlayer('Roofi1', role: roleRepository.getRoleById('roofi'));
- test/player_serialization_test.dart
  - L8: id: 'roofi',
  - L9: name: 'The Roofi',
- test/role_eventualities_matrix_test.dart
  - L579: test('Roofi blocks single Dealer on following night and silences next day',
  - L586: 'roofi',
  - L595: 'roofi': 'dealer',
- test/role_smoke_playthrough_all_roles_test.dart
  - L190: 'roofi': 'dealer',

## The Seasoned Drinker (`seasoned_drinker`)

**Config**
- alliance: `The Party Animals`
- type: `tank`
- night_priority: `0`
- ability: `(none)`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `False`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L894: if (victim.role.id == 'seasoned_drinker' && isDealerAttempt) {
- lib/models/player.dart
  - L134: if (role.id == 'seasoned_drinker') {

**Test Mentions (sample)**
- test/gameplay_scenarios_test.dart
  - L524: role: roleRepository.getRoleById('seasoned_drinker'),
  - L536: (p) => p.role.id == 'seasoned_drinker',

## The Second Wind (`second_wind`)

**Config**
- alliance: `Variable`
- type: `convertible`
- night_priority: `0`
- ability: `(none)`
- start_alliance: `PARTY_ANIMAL`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L835: if (victim.role.id == 'second_wind' &&
  - L850: if (victim.role.id == 'second_wind' && causeLower.contains('refus')) {
  - L1576: p.role.id == 'second_wind' && p.secondWindPendingConversion)
- lib/logic/script_builder.dart
  - L370: roleId: 'second_wind',
  - L474: (p) => p.role.id == 'second_wind' && p.secondWindPendingConversion,

**Test Mentions (sample)**
- test/gameplay_scenarios_test.dart
  - L204: role: roleRepository.getRoleById('second_wind'),
  - L215: gameEngine.players.firstWhere((p) => p.role.id == 'second_wind');
  - L579: role: roleRepository.getRoleById('second_wind'),
- test/role_eventualities_matrix_test.dart
  - L239: } else if (step.roleId == 'second_wind') {
  - L318: 'second_wind',
  - L323: final sw = _firstAliveByRoleId(engine, 'second_wind');
- test/role_smoke_playthrough_all_roles_test.dart
  - L222: if (role.id == 'second_wind') {
  - L223: final sw = _firstAliveByRoleId(engine, 'second_wind');
- â€¦(3 more matches omitted)

## The Silver Fox (`silver_fox`)

**Config**
- alliance: `The Party Animals`
- type: `disruptive`
- night_priority: `1`
- ability: `force_reveal`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L1668: case 'silver_fox':
  - L1670: .where((p) => p.role.id == 'silver_fox' && p.isActive)
- lib/logic/script_builder.dart
  - L170: if (p.role.id == 'silver_fox' && p.silverFoxAbilityUsed) continue;
  - L225: 'silver_fox',
  - L645: } else if (role.id == 'silver_fox') {

**Test Mentions (sample)**
- test/gameplay_scenarios_test.dart
  - L700: role: roleRepository.getRoleById('silver_fox'),
- test/role_smoke_playthrough_all_roles_test.dart
  - L192: 'silver_fox': 'dealer',

## The Sober (`sober`)

**Config**
- alliance: `The Party Animals`
- type: `protective`
- night_priority: `1`
- ability: `send_home`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L921: // Sober can send someone home. If a Dealer is sent home, there is no Dealer murder tonight.
  - L994: report.writeln('• The Sober sent ${target.name} home early.');
  - L1640: case 'sober':
- lib/logic/script_builder.dart
  - L166: if (p.soberSentHome) continue; // Skip players sent home by Sober
  - L169: if (p.role.id == 'sober' && p.soberAbilityUsed) continue;
  - L217: // 1. Sober (send someone home - affects who wakes)
- lib/models/player.dart
  - L31: bool soberAbilityUsed = false; // Sober's one-time send home
  - L32: bool soberSentHome = false; // Player sent home by Sober this night
- â€¦(9 more matches omitted)

**Test Mentions (sample)**
- test/gameplay_scenarios_test.dart
  - L689: gameEngine.addPlayer('Sober1', role: roleRepository.getRoleById('sober'));
- test/night_resolver_test.dart
  - L160: test('Sober sends Dealer home and blocks all kills', () {
  - L174: id: 'sober',
  - L175: name: 'The Sober',
- test/role_eventualities_matrix_test.dart
  - L554: test('Sober sending Dealer home prevents Dealer murder', () async {
  - L560: 'sober',
  - L569: 'sober': 'dealer',
- â€¦(2 more matches omitted)

## The Tea Spiller (`tea_spiller`)

**Config**
- alliance: `The Party Animals`
- type: `reactive`
- night_priority: `0`
- ability: `(none)`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L1850: case 'tea_spiller':
- lib/logic/script_builder.dart
  - L709: } else if (role.id == 'tea_spiller') {
  - L719: roleId: 'tea_spiller',

**Test Mentions (sample)**
- test/gameplay_scenarios_test.dart
  - L692: role: roleRepository.getRoleById('tea_spiller'),
- test/role_eventualities_matrix_test.dart
  - L699: 'tea_spiller',
  - L711: final tea = engine.players.firstWhere((p) => p.role.id == 'tea_spiller');
  - L713: (p) => p.isAlive && p.role.id != 'tea_spiller' && p.role.id != 'host',

## The Wallflower (`wallflower`)

**Config**
- alliance: `The Party Animals`
- type: `investigative`
- night_priority: `5`
- ability: `witness_murder`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L1876: case 'wallflower':
  - L1877: final wallflower = players
  - L1878: .where((p) => p.role.id == 'wallflower' && p.isActive)
- lib/logic/script_builder.dart
  - L20: /// - Integrated roles (Whore, Wallflower, Ally Cat) wake with Dealer
  - L49: // (e.g., Whore/Wallflower/Ally Cat are woken alongside other roles).
  - L212: // Whore wakes with Dealers. Wallflower wakes with Dealers. Ally Cat wakes with Bouncer.
- â€¦(15 more matches omitted)

**Test Mentions (sample)**
- test/gameplay_scenarios_test.dart
  - L37: role: roleRepository.getRoleById('wallflower'),
  - L54: role: roleRepository.getRoleById('wallflower'),
  - L66: test('Game requires at least 1 Wallflower', () {
- test/role_eventualities_matrix_test.dart
  - L61: final includeWallflower = roleUnderTest.id != 'wallflower';
  - L70: engine.addPlayer('WF1', role: _requireRole('wallflower'));
  - L121: if (!normalized.contains('wallflower')) {
- test/role_smoke_playthrough_all_roles_test.dart
  - L143: // Wallflower is required. If this is the role under test, use it in that slot.
  - L144: if (roleUnderTest.id == 'wallflower') {
  - L145: engine.addPlayer('Wallflower 1', role: roleUnderTest);
- test/wallflower_witness_test.dart
  - L58: test('Wallflower can skip witnessing (queues skip, not witness)', () async {
- â€¦(31 more matches omitted)

## The Whore (`whore`)

**Config**
- alliance: `The Dealers`
- type: `defensive`
- night_priority: `0`
- ability: `(none)`
- repeatable: `False`

**Wiring**
- script_builder.dart mention: `True`
- game_engine.dart mention: `True`
- tests mention: `True`

**Engine / Script Mentions (sample)**
- lib/logic/game_engine.dart
  - L316: final whore = roleRepository.getRoleById('whore');
  - L319: if (whore != null) addPlayer('Whore1', role: whore);
  - L1188: // Whore: vote deflection (only triggers when Dealer or Whore is voted out).
- lib/logic/script_builder.dart
  - L20: /// - Integrated roles (Whore, Wallflower, Ally Cat) wake with Dealer
  - L49: // (e.g., Whore/Wallflower/Ally Cat are woken alongside other roles).
  - L180: if (p.role.id == 'whore') {
- â€¦(20 more matches omitted)

**Test Mentions (sample)**
- test/whore_deflection_test.dart
  - L19: // Setup: 1 Dealer, 1 Whore, 2 Party Animals
  - L21: gameEngine.addPlayer('Whore1', role: repo.getRoleById('whore'));
  - L46: test('Whore deflection saves a Dealer from being voted out', () {
- test/whore_save_load_test.dart
  - L8: test('save/load persists Whore deflection target', () async {
  - L14: final whoreRole = roleRepo.getRoleById('whore');
  - L26: final whore = engine.players.firstWhere((p) => p.role.id == 'whore');
- test/whore_test.dart
  - L20: group('The Whore Scenarios', () {
  - L21: test('Whore deflection saves a Dealer from being voted out', () async {
  - L22: // Setup: 1 Dealer, 1 Whore, 2 Party Animals
- â€¦(33 more matches omitted)


